<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Konfirmasi PIN | AZ•KO</title>
<style>
body {
  margin:0;
  font-family: Arial;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#fff;
}
.pin-container {
  text-align:center;
  width:90%;
  max-width:350px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:16px;
}
.pin-container img { max-width:150px; }
.pin-box {
  display:flex;
  justify-content:center;
  gap:8px;
}
.pin-box input {
  width:40px;
  height:50px;
  text-align:center;
  font-size:24px;
  border:1px solid #ccc;
  border-radius:8px;
  background:#fff;
  pointer-events:none; /* disable cursor */
}
#loader {
  display:none;
  border:4px solid #f3f3f3;
  border-top:4px solid #000;
  border-radius:50%;
  width:40px;
  height:40px;
  animation: spin 1s linear infinite;
  margin:12px 0;
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
#pinStatus {
  font-weight:bold;
  margin-bottom:12px;
}
.keypad {
  display:grid;
  grid-template-columns: repeat(3, 70px);
  gap:12px;
  justify-content:center;
  margin-bottom:16px;
}
.keypad button {
  width:70px;
  height:70px;
  border:none;
  border-radius:50%;
  background:#eee;
  color:#000;
  font-size:24px;
  cursor:pointer;
  user-select:none;
  transition:0.1s;
}
.keypad button.active { background:#000; color:#fff; }
#enterBtn {
  width:70px;
  height:70px;
  border:none;
  border-radius:50%;
  background:#000;
  color:#fff;
  font-size:32px;
  display:flex;
  justify-content:center;
  align-items:center;
  cursor:pointer;
  transition:0.2s;
}
#enterBtn:hover { background:#333; }

/* Shake effect */
@keyframes shake {
  0% { transform: translateX(0); }
  20% { transform: translateX(-8px); }
  40% { transform: translateX(8px); }
  60% { transform: translateX(-8px); }
  80% { transform: translateX(8px); }
  100% { transform: translateX(0); }
}
.shake { animation: shake 0.3s; }

</style>
</head>
<body>

<div class="pin-container">
  <img src="logo.png" alt="AZ•KO Logo">

  <div class="pin-box" id="pinBox">
    <input type="password" maxlength="1" class="pin-digit" readonly>
    <input type="password" maxlength="1" class="pin-digit" readonly>
    <input type="password" maxlength="1" class="pin-digit" readonly>
    <input type="password" maxlength="1" class="pin-digit" readonly>
    <input type="password" maxlength="1" class="pin-digit" readonly>
    <input type="password" maxlength="1" class="pin-digit" readonly>
  </div>

  <div id="loader"></div>
  <div id="pinStatus"></div>

  <div class="keypad">
    <button onmousedown="pressKey('1', this)" onmouseup="releaseKey(this)">1</button>
    <button onmousedown="pressKey('2', this)" onmouseup="releaseKey(this)">2</button>
    <button onmousedown="pressKey('3', this)" onmouseup="releaseKey(this)">3</button>
    <button onmousedown="pressKey('4', this)" onmouseup="releaseKey(this)">4</button>
    <button onmousedown="pressKey('5', this)" onmouseup="releaseKey(this)">5</button>
    <button onmousedown="pressKey('6', this)" onmouseup="releaseKey(this)">6</button>
    <button onmousedown="pressKey('7', this)" onmouseup="releaseKey(this)">7</button>
    <button onmousedown="pressKey('8', this)" onmouseup="releaseKey(this)">8</button>
    <button onmousedown="pressKey('9', this)" onmouseup="releaseKey(this)">9</button>
    <button onmousedown="backspaceKey(this)" onmouseup="releaseKey(this)">←</button>
    <button onmousedown="pressKey('0', this)" onmouseup="releaseKey(this)">0</button>
    <button onmousedown="clearKey(this)" onmouseup="releaseKey(this)">C</button>
  </div>

  <button id="enterBtn" onclick="checkPin()">✓</button>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw-C9LksZ_UoOMotoaEoNOPg7F_eK09DoexsD8ViF9kls3eod3Kt5uDlvcb-TmV7O-T/exec";
const tempUser = localStorage.getItem("tempUser");
if(!tempUser) window.location.href = "index.html";

const digits = document.querySelectorAll(".pin-digit");
const pinBox = document.getElementById("pinBox");
const loader = document.getElementById("loader");
const pinStatus = document.getElementById("pinStatus");

// Keypad real-time
function pressKey(num, btn){
  btn.classList.add("active");
  for(let input of digits){
    if(!input.value){
      input.value = num;
      break;
    }
  }
}
function releaseKey(btn){ btn.classList.remove("active"); }
function backspaceKey(btn){
  btn.classList.add("active");
  for(let i=digits.length-1;i>=0;i--){
    if(digits[i].value){ digits[i].value=''; break; }
  }
}
function clearKey(btn){ btn.classList.add("active"); digits.forEach(d=>d.value=''); }
digits.forEach(d=>d.addEventListener('mouseup',()=>d.blur()));

// Validasi PIN
function checkPin(){
  const pin = Array.from(digits).map(d=>d.value).join('').trim();
  if(pin.length !==6){ triggerShake(); return showStatus('PIN harus 6 digit!', 'red'); }

  loader.style.display='block';
  showStatus('Memeriksa PIN...', '#000');

  setTimeout(()=>{
    fetch(SCRIPT_URL)
      .then(res=>res.json())
      .then(data=>{
        loader.style.display='none';
        const user = data.find(u=>u.username.toString().trim()===tempUser);
        if(!user){ triggerShake(); return showStatus('Username tidak ditemukan!', 'red'); }

        if(user.password.toString().replace(/\s/g,'')===pin){
          showStatus('PIN benar!', 'green');
          localStorage.setItem("username", tempUser);
          localStorage.setItem("nickname", user.nickname||tempUser);
          localStorage.setItem("loginTime", Date.now());
          localStorage.removeItem("tempUser");
          setTimeout(()=>window.location.href="menu.html",500);
        } else {
          triggerShake();
          showStatus('PIN salah!', 'red');
        }
      })
      .catch(err=>{
        loader.style.display='none';
        triggerShake();
        showStatus('Gagal menghubungkan ke server.', 'red');
        console.error(err);
      });
  },1500);
}

function triggerShake(){
  pinBox.classList.add('shake');
  setTimeout(()=>pinBox.classList.remove('shake'),300);
}

function showStatus(text,color){
  pinStatus.textContent = text;
  pinStatus.style.color = color;
}
</script>

</body>
</html>
