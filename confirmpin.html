<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Konfirmasi PIN</title>
<style>
  body{
    margin:0;
    font-family:Inter, system-ui, Arial, sans-serif;
    background:#fff;
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
  }
  .card{
    width:320px;
    padding:30px;
    border-radius:16px;
    box-shadow:0 10px 30px rgba(0,0,0,0.08);
    text-align:center;
  }
  h2{margin-bottom:20px;color:#111;}
  .dots{display:flex;justify-content:center;gap:10px;margin-bottom:20px;}
  .dot{
    width:12px;height:12px;border-radius:50%;
    border:2px solid #ccc;transition:.2s;
  }
  .dot.filled{background:#333;border-color:#333;}
  .pad{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:12px;
  }
  .key{
    height:55px;
    border:none;
    background:#f2f2f2;
    border-radius:50%;
    font-size:18px;
    cursor:pointer;
    transition:background .15s;
  }
  .key:active{background:#ddd;}
  .bottom{
    margin-top:15px;
    color:#777;
    font-size:13px;
  }
  #statusText{margin-top:10px;font-size:13px;min-height:18px;color:red;}
</style>
</head>
<body>
  <div class="card">
    <h2>Masukkan PIN</h2>
    <div class="dots" id="pinContainer">
      <div class="dot"></div><div class="dot"></div><div class="dot"></div>
      <div class="dot"></div><div class="dot"></div><div class="dot"></div>
    </div>

    <div class="pad">
      <button class="key">1</button><button class="key">2</button><button class="key">3</button>
      <button class="key">4</button><button class="key">5</button><button class="key">6</button>
      <button class="key">7</button><button class="key">8</button><button class="key">9</button>
      <button class="key" id="reset">⟲</button><button class="key">0</button><button class="key" id="back">⌫</button>
    </div>
    <div id="statusText"></div>
    <div class="bottom">Gunakan PIN sesuai username Anda</div>
  </div>

<script>
  const username = sessionStorage.getItem("username") || localStorage.getItem("username");
  const password = sessionStorage.getItem("password") || localStorage.getItem("password");

  if(!username){ window.location.href = "index.html"; }

  const dots = document.querySelectorAll(".dot");
  const keys = document.querySelectorAll(".key");
  const statusText = document.getElementById("statusText");
  let input = "";

  function updateDots(){
    dots.forEach((d,i)=> d.classList.toggle("filled", i < input.length));
  }

  function vibrate(ms){ if("vibrate" in navigator) navigator.vibrate(ms); }

  function resetPin(){
    input="";
    updateDots();
  }

  async function verifyPin(){
    statusText.style.color="#555";
    statusText.textContent="Memeriksa...";
    await new Promise(r=>setTimeout(r,1000)); // lebih lama biar natural
    if(input===password){
      statusText.style.color="green";
      statusText.textContent="PIN benar, masuk...";
      setTimeout(()=> window.location.href="menu.html", 800);
    } else {
      statusText.style.color="red";
      statusText.textContent="PIN salah, coba lagi.";
      vibrate(300);
      resetPin();
    }
  }

  keys.forEach(k=>{
    k.addEventListener("click",()=>{
      const val = k.textContent.trim();
      vibrate(20);
      if(val==="⟲"){ resetPin(); return; }
      if(val==="⌫"){ input=input.slice(0,-1); updateDots(); return; }
      if(/[0-9]/.test(val)){
        if(input.length<6){ input+=val; updateDots(); }
        if(input.length===6){ verifyPin(); }
      }
    });
  });
</script>
</body>
</html>
